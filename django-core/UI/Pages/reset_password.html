<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TaskFlowPro – Reset Password</title>

    <link rel="stylesheet" href="/static/CSS/style.css">
    <link rel="stylesheet" href="/static/CSS/login.css">
</head>

<body class="login-page">

<div class="login-container">

    <!-- LEFT BRAND SECTION -->
    <section class="login-brand">
        <div class="brand-content">

            <img
                src="/static/Images/TaskFlowPro.png"
                alt="TaskFlowPro illustration"
                class="brand-image"
            />

            <h1 class="brand-title">TaskFlowPro</h1>

            <p class="brand-tagline">
                Secure access.<br>
                <span>One last step.</span>
            </p>

            <p class="brand-subtext">
                Create a new password to regain access to your account.
            </p>

        </div>
    </section>

    <!-- RIGHT RESET PANEL -->
    <section class="login-panel">

        <h2>Reset password</h2>
        <p class="subtitle">
            Choose a strong new password
        </p>

        <p id="errorMsg"></p>

        <input
            type="password"
            id="newPassword"
            placeholder="New password"
        />

        <input
            type="password"
            id="confirmPassword"
            placeholder="Confirm new password"
        />

        <button class="primary" onclick="resetPassword()">
            Reset password
        </button>

        <button class="link" onclick="navigateToLogin()">
            ← Back to login
        </button>

    </section>

</div>

<script>
function navigateToLogin() {
    window.location.href = "/login/";
}

function resetPassword() {
    const params = new URLSearchParams(window.location.search);
    const token = params.get("token");

    const newPassword = document.getElementById("newPassword").value;
    const confirmPassword = document.getElementById("confirmPassword").value;
    const errorEl = document.getElementById("errorMsg");

    errorEl.style.display = "none";

    if (!newPassword || !confirmPassword) {
        errorEl.innerText = "All fields are required";
        errorEl.style.display = "block";
        return;
    }

    if (newPassword !== confirmPassword) {
        errorEl.innerText = "Passwords do not match";
        errorEl.style.display = "block";
        return;
    }

    fetch("/api/auth/reset-password/", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            token: token,
            new_password: newPassword
        })
    })
    .then(res => res.json())
    .then(data => {
        if (data.error) {
            errorEl.innerText = data.error;
            errorEl.style.display = "block";
        } else {
            alert("Password reset successful. Please login.");
            window.location.href = "/login/";
        }
    })
    .catch(() => {
        errorEl.innerText = "Something went wrong. Try again.";
        errorEl.style.display = "block";
    });
}
</script>

</body>
</html>
